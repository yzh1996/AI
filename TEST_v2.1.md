# v2.1 快速测试指南

## 🎯 测试目标

验证以下问题已修复：
1. ✅ 字段名不再显示 undefined
2. ✅ 不存在的表/视图不会显示在依赖关系中
3. ✅ 支持查询表（不仅仅是视图）
4. ✅ 表没有依赖时正确显示

## 🚀 开始测试

### 1. 启动服务

```bash
cd E:\yzh\workspace\code\ai\langgraph_test
python web_view_analyzer.py
```

### 2. 打开浏览器

访问：http://localhost:5000

## 📋 测试用例

### 测试 1：查询视图（验证基础功能）

**步骤**：
1. 在输入框输入：`live_base_view`
2. 点击"分析"按钮
3. 观察依赖树

**预期结果**：
- ✅ 显示视图图标 📊
- ✅ 展示所有依赖的表和视图
- ✅ 依赖列表中的对象都存在（可以点击查看详情）

**验证点**：
- [ ] 视图图标正确
- [ ] 依赖树正确展开
- [ ] 所有节点都可以点击

---

### 测试 2：查询表（验证新功能）

**步骤**：
1. 在输入框输入：`live_base`（一个表名）
2. 点击"分析"按钮
3. 观察显示结果

**预期结果**：
- ✅ 显示表图标 📋
- ✅ 提示："该表没有依赖任何表或视图"
- ✅ 可以点击表名查看表结构

**验证点**：
- [ ] 表图标正确（📋 不是 📊）
- [ ] 提示信息正确
- [ ] 可以点击查看表结构

---

### 测试 3：查看表结构（验证字段名修复）

**步骤**：
1. 查询任意表或视图
2. 点击依赖树中的任意表节点
3. 查看右侧详情面板

**预期结果**：
- ✅ 字段名正确显示（不是 undefined）
- ✅ 数据类型正确显示
- ✅ 可空状态正确显示（YES/NO）
- ✅ 默认值正确显示

**验证点**：
- [ ] 字段名列显示正确的字段名
- [ ] 没有 undefined 字样
- [ ] 数据类型完整（如 int(11), varchar(255)）
- [ ] 可空状态有颜色标签

**截图示例**：
```
字段列表:
┌──────────────────────────────────────┐
│ 字段名    │ 类型        │ 可空 │ 注释 │
├──────────────────────────────────────┤
│ id        │ int(11)     │ NO   │ ... │  ← 应该显示 "id" 而不是 "undefined"
│ anchor_id │ bigint(20)  │ YES  │ ... │
│ room_name │ varchar(255)│ YES  │ ... │
└──────────────────────────────────────┘
```

---

### 测试 4：不存在的对象过滤（验证修复）

**步骤**：
1. 查询一个视图（如 `live_base_view`）
2. 查看依赖树中的所有对象
3. 尝试点击每个对象查看详情

**预期结果**：
- ✅ 所有显示的对象都存在
- ✅ 点击任何对象都能正常显示详情
- ✅ 不会出现"表或视图不存在"的错误

**验证点**：
- [ ] 依赖树中的所有对象都可以点击
- [ ] 点击后都能正常显示表结构
- [ ] 没有 404 错误

---

### 测试 5：编辑注释（验证完整流程）

**步骤**：
1. 查询一个表：`live_base`
2. 点击表名查看详情
3. 在"表注释"输入框输入：`测试表注释`
4. 在第一个字段的注释输入框输入：`测试字段注释`
5. 点击"保存注释"按钮

**预期结果**：
- ✅ 显示"保存成功"提示
- ✅ 刷新页面后注释仍然存在
- ✅ 切换到其他表再切换回来，注释仍然存在

**验证点**：
- [ ] 保存成功提示显示
- [ ] 注释持久化保存
- [ ] table_comments.json 文件生成

---

### 测试 6：查询不存在的对象（验证错误处理）

**步骤**：
1. 在输入框输入：`non_existent_table_12345`
2. 点击"分析"按钮

**预期结果**：
- ✅ 显示错误提示："'non_existent_table_12345' 不存在"
- ✅ 不显示依赖树
- ✅ 页面不崩溃

**验证点**：
- [ ] 错误提示正确显示
- [ ] 没有 JavaScript 错误
- [ ] 可以继续查询其他对象

---

## 🔍 详细验证

### 验证字段名显示

打开浏览器开发者工具（F12），查看 Console 和 Network：

1. **Network 标签**：
   - 找到 `/api/table_structure` 请求
   - 查看 Response 数据
   - 确认返回的字段包含 `name`, `column_type`, `nullable`, `custom_comment`

2. **Console 标签**：
   - 确认没有 JavaScript 错误
   - 确认没有 "undefined" 相关的警告

### 验证对象存在性

1. 查询一个复杂的视图
2. 查看依赖树中的所有对象
3. 逐个点击验证都能正常显示

### 验证表查询功能

测试多个表：
```
- live_base
- jl_user
- live_info_traffic
```

每个表都应该：
- 显示表图标 📋
- 提示没有依赖
- 可以查看表结构

## ✅ 测试检查清单

### 基础功能
- [ ] 服务正常启动
- [ ] 页面正常加载
- [ ] 输入框可以输入
- [ ] 分析按钮可以点击

### 视图查询
- [ ] 可以查询视图
- [ ] 依赖树正确显示
- [ ] 视图图标正确（📊）
- [ ] 可以展开/折叠

### 表查询（新功能）
- [ ] 可以查询表
- [ ] 表图标正确（📋）
- [ ] 提示信息正确
- [ ] 可以查看表结构

### 表结构显示
- [ ] 字段名正确显示（不是 undefined）
- [ ] 数据类型正确显示
- [ ] 可空状态正确显示
- [ ] 默认值正确显示
- [ ] 注释可以编辑

### 对象过滤
- [ ] 只显示存在的对象
- [ ] 不存在的对象被过滤
- [ ] 所有显示的对象都可以点击

### 注释功能
- [ ] 表注释可以编辑
- [ ] 字段注释可以编辑
- [ ] 保存功能正常
- [ ] 注释持久化

### 错误处理
- [ ] 不存在的对象显示错误
- [ ] 网络错误有提示
- [ ] 页面不崩溃

## 🐛 问题报告模板

如果发现问题，请按以下格式报告：

```
问题标题: [简短描述]

复现步骤:
1. [步骤1]
2. [步骤2]
3. [步骤3]

预期结果:
[应该发生什么]

实际结果:
[实际发生了什么]

截图:
[如果可能，提供截图]

浏览器信息:
- 浏览器: Chrome/Firefox/Edge
- 版本: [版本号]

控制台错误:
[如果有，粘贴 Console 中的错误信息]
```

## 📊 测试结果记录

```
测试日期: 2026-01-27
测试人员: [你的名字]

测试结果:
- 测试 1 (查询视图): ✅ 通过 / ❌ 失败
- 测试 2 (查询表): ✅ 通过 / ❌ 失败
- 测试 3 (查看表结构): ✅ 通过 / ❌ 失败
- 测试 4 (对象过滤): ✅ 通过 / ❌ 失败
- 测试 5 (编辑注释): ✅ 通过 / ❌ 失败
- 测试 6 (错误处理): ✅ 通过 / ❌ 失败

发现的问题:
1. [问题描述]
2. [问题描述]

总体评价:
[测试总结]
```

## 🎉 测试通过标准

所有以下项目都应该正常工作：

1. ✅ 字段名正确显示（不是 undefined）
2. ✅ 可以查询表和视图
3. ✅ 表没有依赖时正确显示
4. ✅ 只显示存在的对象
5. ✅ 所有节点都可以点击查看详情
6. ✅ 注释功能正常
7. ✅ 错误处理正确
8. ✅ 没有 JavaScript 错误

---

**测试版本**: v2.1
**预计测试时间**: 15-20 分钟
**测试难度**: ⭐⭐ (简单)

祝测试顺利！如有问题请查看 BUGFIX_v2.1.md 了解详细修复内容。
