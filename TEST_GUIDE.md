# 功能测试指南

## 🧪 快速测试步骤

### 1. 启动服务

```bash
cd E:\yzh\workspace\code\ai\langgraph_test
python web_view_analyzer.py
```

看到以下输出表示成功：
```
============================================================
StarRocks 视图依赖关系 Web 分析工具
============================================================
数据库: donggua
访问地址: http://localhost:5000
============================================================
```

### 2. 打开浏览器

访问：http://localhost:5000

### 3. 测试依赖关系分析

1. 在左侧输入框输入：`live_base_view`
2. 点击"🔍 分析"按钮
3. ✅ 应该看到依赖树展开，显示所有依赖的表和视图

### 4. 测试表结构查看

1. 点击依赖树中的任意表节点（例如：`live_base`）
2. ✅ 右侧面板应该显示表结构信息
3. ✅ 应该看到：
   - 表名称
   - 表注释输入框
   - 字段列表表格（字段名、类型、可空、默认值、注释）

### 5. 测试注释编辑

1. 在"表注释"输入框中输入：`这是一个测试注释`
2. 在第一个字段的注释输入框中输入：`测试字段注释`
3. 点击底部的"💾 保存注释"按钮
4. ✅ 应该看到"✓ 保存成功"的绿色提示

### 6. 测试注释持久化

1. 点击依赖树中的其他表
2. 再次点击之前编辑的表
3. ✅ 应该看到之前保存的注释仍然存在

### 7. 验证数据文件

```bash
# 查看注释文件是否生成
cat table_comments.json
```

应该看到类似内容：
```json
{
  "donggua.live_base": {
    "table_comment": "这是一个测试注释",
    "column_comments": {
      "id": "测试字段注释"
    },
    "updated_at": "2026-01-27T17:30:00"
  }
}
```

## 🎯 功能检查清单

### 基础功能
- [ ] 服务正常启动
- [ ] 页面正常加载
- [ ] 左右分栏布局正确显示

### 依赖分析功能
- [ ] 输入视图名称可以分析
- [ ] 依赖树正确显示
- [ ] 视图节点可以展开/折叠
- [ ] 表节点不可展开

### 表结构查看功能
- [ ] 点击表节点显示详情
- [ ] 表名正确显示
- [ ] 字段列表完整显示
- [ ] 数据类型正确显示
- [ ] 可空状态正确显示（YES/NO 标签）
- [ ] 默认值正确显示

### 注释编辑功能
- [ ] 表注释输入框可编辑
- [ ] 字段注释输入框可编辑
- [ ] 保存按钮可点击
- [ ] 保存成功有提示
- [ ] 保存失败有错误提示

### 注释持久化功能
- [ ] 注释保存后刷新页面仍存在
- [ ] 切换表后再切换回来注释仍存在
- [ ] table_comments.json 文件正确生成
- [ ] JSON 文件格式正确

### 界面交互
- [ ] 节点悬停有高亮效果
- [ ] 选中节点有明显标识
- [ ] 输入框聚焦有边框高亮
- [ ] 按钮悬停有动画效果
- [ ] 加载状态有提示

## 🐛 常见问题排查

### 问题 1：页面无法加载

**检查项**：
```bash
# 1. 检查服务是否启动
netstat -ano | findstr :5000

# 2. 检查 Python 进程
tasklist | findstr python

# 3. 查看错误日志
# 在启动服务的终端查看输出
```

### 问题 2：点击节点没反应

**检查项**：
1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签是否有错误
3. 查看 Network 标签，检查 API 请求是否成功

**常见原因**：
- 后端服务未启动
- 数据库连接失败
- API 路径错误

### 问题 3：注释保存失败

**检查项**：
```bash
# 1. 检查文件写入权限
ls -l table_comments.json

# 2. 检查磁盘空间
df -h

# 3. 查看后端日志
# 在服务终端查看错误信息
```

### 问题 4：表结构显示不完整

**检查项**：
1. 确认数据库连接正常
2. 确认有查询 information_schema 的权限
3. 检查表名是否正确

**测试 SQL**：
```sql
-- 测试权限
SELECT * FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'donggua' LIMIT 1;

SELECT * FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = 'donggua' LIMIT 1;
```

## 📊 性能测试

### 测试大表

1. 选择一个字段数量较多的表（>50 个字段）
2. 点击查看详情
3. 观察加载时间
4. 检查页面是否流畅

### 测试深层依赖

1. 选择一个依赖层级较深的视图（>3 层）
2. 逐层展开所有节点
3. 观察加载速度
4. 检查是否有卡顿

## 🔧 调试技巧

### 1. 查看 API 请求

打开浏览器开发者工具 → Network 标签：
- 查看请求 URL
- 查看请求参数
- 查看响应数据
- 查看响应时间

### 2. 查看 Console 日志

打开浏览器开发者工具 → Console 标签：
- 查看 JavaScript 错误
- 查看自定义日志
- 查看网络错误

### 3. 后端日志

在服务启动的终端查看：
- SQL 查询日志
- 错误堆栈
- API 请求日志

## ✅ 测试通过标准

所有以下项目都应该正常工作：

1. ✅ 服务启动无错误
2. ✅ 页面加载正常
3. ✅ 依赖分析功能正常
4. ✅ 表结构查看功能正常
5. ✅ 注释编辑功能正常
6. ✅ 注释保存功能正常
7. ✅ 注释持久化功能正常
8. ✅ 界面交互流畅
9. ✅ 无 JavaScript 错误
10. ✅ 无 API 请求失败

## 📝 测试报告模板

```
测试日期：2026-01-27
测试人员：[你的名字]
测试环境：Windows / Python 3.x / Chrome

功能测试结果：
- 依赖分析：✅ 通过 / ❌ 失败
- 表结构查看：✅ 通过 / ❌ 失败
- 注释编辑：✅ 通过 / ❌ 失败
- 注释保存：✅ 通过 / ❌ 失败
- 注释持久化：✅ 通过 / ❌ 失败

发现的问题：
1. [问题描述]
2. [问题描述]

建议改进：
1. [改进建议]
2. [改进建议]
```

---

祝测试顺利！如有问题请查看 UPDATE_LOG.md 或联系开发者。
